const cors = require('cors');
const rateLimit = require('express-rate-limit');
const helmet = require('helmet');

const setupSecurity = (app) => {
  // CORS configuration
  app.use(cors({
    origin: process.env.NODE_ENV === 'production' 
      ? process.env.FRONTEND_URL 
      : 'http://localhost:3000',
    credentials: true,
    optionsSuccessStatus: 200
  }));

  // Basic security headers with helmet
  app.use(helmet());

  // Rate limiting for APIs
  const limiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 100, // limit each IP to 100 requests per windowMs
    message: {
      success: false,
      message: 'Too many requests, please try again later.'
    }
  });

  // Apply rate limiting to all routes
  app.use('/api/', limiter);

  // Security headers
  app.use((req, res, next) => {
    res.setHeader('X-Content-Type-Options', 'nosniff');
    res.setHeader('X-Frame-Options', 'DENY');
    res.setHeader('X-XSS-Protection', '1; mode=block');
    next();
  });
};

module.exports = { setupSecurity };
